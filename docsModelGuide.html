<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SimVascular Docs</title>

    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />

    <link href="css/shop-item.css" rel="stylesheet" type="text/css" />

    <link href="css/codestyle.css" rel="stylesheet" type="text/css" />    

    <link rel="stylesheet" href="font-awesome-4.1.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">

    <link rel="shortcut icon" href="img/favicon.ico">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                <i class="fa fa-bars" id="barIcon"></i>
              </button>
                <a class="navbar-brand" id="brandName" href="index.html">
                  <img src="img/svlogo/svLogoSmallText.png" alt="...">
                </a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">            
                <ul class="nav navbar-nav">
                  
                  <!-- GETTING STARTED -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><span class="fa fa-caret-square-o-right"></span> Getting Started</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsInstallation.html"><b><span class="fa fa-sign-in fa-rotate-90"></span> Installation</b></a></li>   
                      <li role="presentation" class="divider"></li>                   
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsCompile.html"><b><span class="fa fa-file-text-o"></span> Compile Sources</b></a></li>  
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsCodeSnippets.html"><b><span class="fa fa-indent"></span> Code Snippets</b></a></li>                                  
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsQuickGuide.html"><b><span class="icon ion-ios7-bolt"></span> Quick Guide</b></a></li>           
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="comingSoon.html"><b>Doxygen Docs for C++</b></a></li>  
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="comingSoon.html"><b>Doxygen Docs for Tcl</b></a></li>  
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="comingSoon.html"><b>Doxygen Docs for Fortran</b></a></li>           
                    </ul>
                  </li>                  

                  <!-- USER GUIDES -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><span class="fa fa-user"></span> User Guides</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsImageGuide.html"><b><span class="icon ion-image"></span> Medical Images</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsModelGuide.html"><b><span class="icon ion-settings"></span> Modeling</b></a></li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsMeshing.html"><b><span class="icon ion-ios7-keypad"></span> Meshing</b></a></li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsFlowSolver.html"><b><span class="icon ion-play"></span> Simulation</b></a></li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsRefs.html"><b><span class="icon ion-document-text"></span> References</b></a></li>
                    </ul>
                  </li>

                  <!-- CLINCAL CASES -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><i class="fa fa-stethoscope"></i> Clinical Cases</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase1.html"><b><span class="fa fa-user-md"></span> Aortofemoral Normal (Case 1)</b></a></li>                      
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase2.html"><b><span class="fa fa-user-md"></span> Aortofemoral Normal (Case 2)</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase3.html"><b><span class="fa fa-user-md"></span> Coronary Normal (Case 3)</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase4.html"><b><span class="fa fa-user-md"></span> Healthy Pulmonary (Case 4)</b></a></li>
                    </ul>
                  </li>

                  <!-- svCOMMUNITY -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><i class="fa fa-users"></i> svCommunity</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/forums/viewforum.php?f=188"><b><span class="fa fa-users"></span> Public Forum</b></a></li>                                          
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/mailman/listinfo/simvascular-news"><b><span class="fa fa-sign-in"></span> Join News Mailing List</b></a></li>                      
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/pipermail/simvascular-news/"><b><span class="fa fa-pencil-square-o"></span> News Mailing List Archive</b></a></li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/mailman/listinfo/simvascular-users"><b><span class="fa fa-sign-in"></span> Join User Mailing List</b></a></li>                      
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://simvascular-users.40599.n7.nabble.com/"><b><span class="fa fa-pencil-square-o"></span> User Mailing List Archive</b></a></li>                      
                    </ul>
                  </li>

                    <!-- <li><a href="docsQuickGuide.html" id="btnQuickGuide"><b><span class="icon ion-ios7-bolt"></span> Quick Guide</b></a></li>
                    <li><a href="docsImageGuide.html" id="btnImageGuide"><b><span class="icon ion-image"></span> Medical Images</b></a></li>
                    <li><a href="docsModelGuide.html" id="btnModelGuide"><b><span class="icon ion-settings"></span> Modeling</b></a></li> 
                    
                    <li><a href="docsMeshing.html" id="btnMeshing"><b><span class="icon ion-ios7-keypad"></span> Meshing</b></a></li>
                    <li><a href="docsPresolver.html" id="btnPresolver"><b><span class="icon ion-log-in"></span> svPre</b></a></li>
                    <li><a href="docsFlowSolver.html" id="btnFlowSolver"><b><span class="icon ion-play"></span> svSolver</b></a></li>
                    <li><a href="docsRefs.html" id="btnRefs"><b><span class="icon ion-document-text"></span> References</b></a></li>
                    <li><a href="clinicalCase1.html" id="btnRefs"><b>Case Studies</b></a></li> -->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <!--Nav Bar -->
<div class="row">
    <div class="col-xs-1 col-sm-1 hidden-md hidden-lg">
    </div>
    <!-- ONE COLUMN OF SPACE -->
    <nav class="hidden-xs hidden-sm col-md-2 col-lg-2 bs-docs-sidebar">





        <ul id="sidebar" class="nav nav-stacked fixed manModelGuide"> <!--Nav Bar -->
<p><h3>Modeling Guide</h3></p>
<li><a href="#modelingIntro">Introduction</a></li>
<li><a href="#modelingPathPlanning">Path Planning</a>
  <ul class="nav nav-stacked">
	<li><a href="#modelingCreatingPath">Creating a Path</a></li>
	<li><a href="#modelingSmoothingPath">Smoothing a Path</a></li>
	<li><a href="#modelingImportingExportingPaths">Importing/Exporting <br>Legacy Paths</a></li>
  </ul>                
</li>
<li><a href="#modelingSegmentation">Segmentation</a>
  <ul class="nav nav-stacked">
	<li><a href="#modelingUsingGroups">Using Groups</a></li>
	<li><a href="#modelingThresholding">Using Thresholding <br>to Define a Countour</a></li>
	<li><a href="#modelingLevelSet">Using Level Sets <br>to Define a Countour</a></li>
	<li><a href="#modelingLoftingPreview">Lofting Preview</a></li>
	<li><a href="#modelingManual">Segmenting an Image <br>Manually</a></li>
	<li><a href="#modelingImportingExportingGroups">Importing/Exporting <br>Legacy Groups</a></li>
  </ul>                
</li>
<li><a href="#modelingSolidModeling">Creating a Solid Model <br>from 2-D Segmentation</a>
  <ul class="nav nav-stacked">
	<li><a href="#modelingCreatingModels">Using Groups of Segmentation <br>to Create Solid Models</a></li>
	<li><a href="#modelingCreatingBranch">Creating a Branch Vessel</a></li>
	<li><a href="#modelingJoining">Joining Vessels Together <br>to Create a Model</a></li>
	<li><a href="#modelingBlending">Blending the Junction of <br>Two Vessels</a></li>
  </ul>                
</li>
<li><a href="#modelingSolidModelingPolyData">Creating a Solid Model <br>with PolyData</a>
  <ul class="nav nav-stacked">
	<li><a href="#modelingCreatingModelsPolyData">Using Groups of Segmentation <br>to Create Solid Models</a></li>
	<li><a href="#modelingPolyDataFaces">Creating and Naming <br>PolyData Model Faces</a></li>
	<li><a href="#modelingEditingPolyData">Editing PolyData Models</a></li>
	<li><a href="#modelingCenterlinesPolyData">Extracting Centerlines</a></li>
  </ul>                
</li>


<h3>Download</h3>
<a href="https://simtk.org/frs/download.php?file_id=4653">Sample Data</a>
</ul>





        
    </nav>
    
    <!--Main Content -->
    <div class="col-xs-10 col-sm-10 col-md-9 col-lg-9" id="manualContent">

      <!-- ACTUAL CONTENT -->





        <div class="manModelGuide"><section id="modelingIntro" class="group"><h1>Creating Geometric Models from Medical Imaging Data</h1>

<p>Our eye is able to distinguish different objects within an image, but to the computer, the image is just a group of numbers to be displayed in a grid format.  It is not able to distinguish what parts of the image correspond to a specific object.  </p>

<p>One way to describe an object within a computing environment is with geometric solid models. 
SimVascular is one system that allows users to generate geometric models from medical imaging data. The first step is to segment the medical imaging data and identify what parts of the image describe the object of interest. While 3D segmentation methods are being developed, this document only details using SimVascular with the 2D segmentation method.  The information from the segmentations is then transformed into a solid model.</p>

<p>The figure that follows describes the process in more detail.  For the segmentation step, paths along the vessels of interest need to be specified first (See <a href="#modelingPathPlanning">Path Planning</a>). 2D segmentations are then generated along each of the paths (See <a href="#modelingSegmentation">Segmentation</a>) These segmentations can then be lofted together to create a solid model. A separate solid model is created for each vessel, and these are all unioned together to create the final model. The last step is to blend the vessel junctions so that they are smoother (see <a href="#modelingCreatingSolidModel">Creating a Solid Model from 2-D Segmentations</a>).</p>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/modelingpipeline.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
</section>
<section id="modelingPathPlanning" class="group"><h2>Path Planning</h2>

<p><a href="#modelingCreatingPath">Section: Creating a path</a> shows you how to generate a path. <a href="#modelingSmoothingPath">Section: Smoothing a path</a> shows you how to smooth a path.  Lastly, <a href="#modelingImportingExportingPaths">Section Importing and Export Legacy Paths</a>, will explain how to save your work, and then load it again after restarting SimVascular.</p>

<p>Some tips to keep in mind as you are constructing paths.</p>

<ol>
<li><p>The paths you create determine where you will be able to perform segmentations.  Make sure your paths cover the entire distance of the vessel that you’re interested in modeling. In general, it is a good idea to make your paths as long as possible. It is much easier to make a path a little longer in both directions than to try to “add on” to a path later.</p></li>
<li><p>The paths are also important in determining how individual vessels can be joined together.  It’s generally helpful if there is some overlap in the paths.  This will ensure that the inlet of the branch vessel will fit entirely inside of the main vessel.</p></li>
<li><p>Lastly, it’s easier if the paths pass near the center of the vessel lumens.  This makes it easier for the segmentation part of the process.</p></li>
</ol>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/path_planning/pathplanningtips.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
</section>
<section id="modelingCreatingPath" class="subgroup"><h3>Creating a Path</h3>

<p>The goal of this exercise is to create a path for the abdominal aorta and the left common and external iliac.  As you will see, you need to create a path (centerline) for each vessel of interest. In <strong>SimVascular</strong>, a path contains two ordered sets of points. One set is &ldquo;Control Points&rdquo;; the other set is &ldquo;Path Points&rdquo; which define a vessle and are calculated using a spline based on the control points.</p>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/path_planning/pathdefinition.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>To create a path (empty):</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Paths" in the SV project in Data Manager
Click "Create Path" in the popup menu
Path Name: aorta
Subdivision Type: "Image Spacing Based" (default)
Click "OK"
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/path_planning/createemptypath.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/path_planning/createpathdialog.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>There are three options for Subdivision Type. Each option uses a different way to calculate the number (n) of path points between two adjacent control points. Assume the total number of control points is Nc.</p>

<p><strong>Total Number</strong> (Np): appoximate total number of path points. n=[(Np-1)/(Nc-1)]-1; the actual total number of path ponts Npa=(n+1)*(Nc-1)+1 <br></p>

<p><strong>Subdivision Number</strong> (Ns): n=Ns-1; Npa=(n+1)*(Nc-1)+1 <br></p>

<p><strong>Image Spacing Based</strong>: Assume s is the minimum spacing of the image; l is the distance between two adjacent control points. n= [l/s]-1; Npa=(n+1)*(Nc-1)+1</p>

<p>Now a new data node “aorta” for the path is created under the data node “Paths” in Data Manager. Double click the data node “aorta&quot; and the tool &ldquo;SV Path Planning” automatically shows up. The new path is empty and has no control or path points so far. </p>

<p><strong>To add a contro point:</strong></p>
<pre class="highlight plaintext"><code>Move the cursor to Axial view in Display
Move the slice to position 475: by scrolling center mouse button or moving Axial slider (in Image Navigator) to 475
Right press and move to zoom in to enlarge the vessel cross secton
Method 1: Click at the center of the vessel; Ctrl+A or click the button "Add Smart"
Method 2(interactive): Move the cursor to the center of the vessle; Shift+Left Click
</code></pre>

<p>A control point is added for the path and should appear under the Control Point List. In Display, the point is shown as a blue or red point, depending on if the point is selected. </p>

<p><strong>To move a control point (interactively):</strong></p>
<pre class="highlight plaintext"><code>Move the cursor to the control point; it becomes red(selected) if not selected yet
Left press on the point and move 
</code></pre>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font>  Use the three 2D views at the same time to check if the contrl point is really located at the ceter of the vessel.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/path_planning/addpoint.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>To accurately locate the crosshair cross point, it&rsquo;s better to <strong>set the crosshair gap size to 0</strong>.</p>
<pre class="highlight plaintext"><code>Menu: Window -&gt; Preferences...
Choose: Editors -&gt; Standard Multi Widget in the dialog
Set "Cross gap size" to 0
</code></pre>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/path_planning/changegapsize.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font>  It is generally a good practice to create paths that extend beyond where you may plan to create a model.</p>

<p>Continue to move down the aorta inferiorly in the Axial 2D View in increments of 25-50 using the Axial slider in Image Navigator or scrolling the center mouse button, and similarly add the center points to the path. When you reach the bifurcation (the aorta splits into the two iliac arteries), continue your path down the LEFT iliac artery. At the same you can see the path in the 3D View. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/path_planning/addpoint2.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Normally SimVascular will insert a control control to the path in the right order, but sometimes a user may need to explicitly insert a control point in a specific location.</p>

<p>To insert a control point to the end of the path:</p>
<pre class="highlight plaintext"><code>Click at the center of the vessel
Click the button "Add To End"
</code></pre>

<p>To insert a control point to the  top of the path:</p>
<pre class="highlight plaintext"><code>Click at the center of the vessel
Click the button "Add To Top"
</code></pre>

<p>To insert a control point above the selected(red) control point:</p>
<pre class="highlight plaintext"><code>Click at the center of the vessel
Click the button "Insert Above"
</code></pre>

<p>To Delete a control point in the path:</p>
<pre class="highlight plaintext"><code>Method 1: select the one you want to remove in the Control Point List and click the button "Delete"
Method 2(interactive): Move the cursor to the point you want to remove and Right Click
</code></pre>

<p>After a complete path is created, you can check the quality by reslicing the image along the path.</p>
<pre class="highlight plaintext"><code>Toggle on the checkbox "Turn on Reslicing"
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/path_planning/pathreslicing.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>A slider appears. You can move the slider to change reslice position. Click the button &quot;Size&rdquo; to change the reslice size to make the whole vessel cross section is inside the reslice. Now, the layout of Display is changed, which has tree windows:</p>

<ul>
<li><strong>The right window (3D view)</strong>:  shows a 2D slice plane (outlined in a red square in reslice size) ,call &ldquo;intensity probe&rdquo;. it is image data that is reconstructed perpendicular to your path.</li>
<li><strong>The left top window (2D view)</strong>: displays the intensities of the slice plane that is perpendicular to the path.  This is the same image as that displayed in the intensity probe. </li>
<li><strong>The left bottom window (2D view)</strong>: shows the magnitude of the image intensity gradients, again in the slice plane perpendicular to the path.  This means that large changes in intensity values, such as that at the edge of vessels, are very bright in this view, and locations with small changes in intensity values, such as in the vessel lumen, are dark, as shown below.</li>
</ul>

<p>To adjust the position of a control point in the reslice:</p>
<pre class="highlight plaintext"><code>Select a control point in Control Point List
Move the cursor to the control point in a 2D view 
Left press on the point and move 
</code></pre>

<p>To add a new control pointin the reslice:</p>
<pre class="highlight plaintext"><code>Move the cursor to a 2D view in Display
Move the cursor to the center of the vessle; Shift+Left Click
</code></pre>

<p>Everytime a point is changed/added, the reslice will updated according the changed path.</p>

<p>You can change the type of path after created. </p>
<pre class="highlight plaintext"><code>Click the button "Change"
</code></pre>
</section>
<section id="modelingSmoothingPath" class="subgroup"><h3>Smoothing a Path</h3>

<p>If your resultant path appears jagged, you may want to smooth your path.  <strong>SimVascular</strong> provides several parameters for smoothing the path.</p>
<pre class="highlight plaintext"><code>Click the button "Smooth"
Subsample: 1
Based on: Control Points
Fourier Mode Number: 15
Click the button "OK
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/path_planning/pathsmoothdialog.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>You should see a much smoother path. &ldquo;Subsample: 1&rdquo; means Subsample every 1 point. Depending on how many points you had in your original path, you may find that the smoothing may make the path deviate from the vessel! This is why smoothing should be used with caution.</p>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/path_planning/pathsmooth1.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Let’s examine these parameters more closely.</p>

<p>&ldquo;Subsample&rdquo;: This parameter specifies which points will be used in the smoothing.  If you enter “5,” then only every 5th point will be used.</p>

<p>&ldquo;Based on&rdquo;: Choose to use control points or path points to smooth the path</p>

<p>“Fourier Mode Number”: Fourier smoothing generates a path using only a subset of the modes that describe your original path.  High modes correspond to very sharp changes in your path, while low modes describe the smoother parts of your path. The fewer modes your path has, the smoother it will be.</p>

<p>Try this exercise useing the following options:</p>
<pre class="highlight plaintext"><code>Subsample: 2
Based on: Control Points
Fourier Mode Number: 5
</code></pre>

<p>You should see a very smooth line with few to no kinks. Does this ultra-smooth path still fit inside the boundaries of the vessel?</p>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/path_planning/pathsmooth2.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><font color="red"><strong>Save the path:</strong> </font> When the data in the project change, remember to save the project by:</p>
<pre class="highlight plaintext"><code>Click "Save SV Projects" on the tool bar
</code></pre>

<p>The path will be saved to a file inside the project folder.</p>
</section>
<section id="modelingImportingExportingPaths" class="subgroup"><h3>Importing and Exporting Paths in Legacy Formats</h3>

<p><strong>Importing Paths:</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Paths" in the SV project in Data Manager
Click "Load Legacy  Paths" in the popup menu
Select a .paths file you would like to load, and click on the “Open” button.
</code></pre>

<p><strong>Exporting Paths:</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Paths" in the SV project in Data Manager
Click "Save Legacy  Paths" in the popup menu
Enter the desired name for the file under “File name:” with the ending “.paths” and click on the “Save” button. 
</code></pre>
</section>
<section id="modelingSegmentation" class="group"><h2>Segmentation</h2>

<p>Extensive research has been conducted in the field of image segmentation, and as a result, many different techniques have been proposed.  The goal of all these techniques is to identify objects or structures within an image in an automated fashion.  For our purposes, we want to find the vessel lumen.</p>

<p>Currently, only 2D segmentation methods have been incorporated into <strong>SimVascular</strong>.  That means that the segmentations are performed in a plane.  So if we want to create a 3D model from our 3D imaging data, we generate a set of 2D segmentations along a given path (See <a href="#modelingPathPlanning">Path Planning</a>).  These 2D segmentations can be stitched together later to create a 3D model.</p>

<p>We use groups to organize these 2D segmentations, and in <a href="#modelingUsingGroups">Section: Using Groups</a>, we will show you how to work with groups. You, the user, must determine the acceptability of a given segmentation.  Look at the image below.  Is the segmentation, show in blue, good or bad?  You really can’t answer that question without more information about the object.  The semi-automated segmentation methods provided within <strong>SimVascular</strong> save you the work of generating the segmented contours, but you must decide if the segmentations are suitable for your purposes. </p>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/segexample.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The following sections teach you about the different techniques available for producing and modifying a 2D contour.  One basic segmentation technique available in SimVascular is thresholding, which uses the image intensities to define a shape (<a href="#modelingThresholding">Using Thresholding to Define a Contour</a>).  The level set method uses both image intensity values and geometric constraints to generate a segmentation (<a href="#modelingLevelSet">Using Level Sets to Define a Contour</a>). You can draw the segmentation by hand (<a href="#modelingManual">Segmenting an Image Manually</a>). </p>

<!-- Or you may have to copy and paste a shape ([ Copying and Pasting Contours](#modelingCopyingPastingContours)).  -->

<p>In the end, you will be using a level-set technique to build the abdominal aorta, and you will be drawing segmentations (like circles, ellipses, etc.) by hand to build the branch vessels. Keep this in mind as you work through the exercises. </p>
</section>
<section id="modelingUsingGroups" class="subgroup"><h3>Using Groups</h3>

<p>Groups are used to organize the 2D segmentations or contours that you create.  You want to have a different group for each vessel that you are creating.  In addition, you might only use a subset of the 2D contours for producing the solid model of the vessel, so for future reference, it’s helpful to save that subset of contours to a new group.</p>

<p>In <strong>SimVascular</strong>, similar to a path, a contour contains two ordered sets of points. One set is &ldquo;Control Points&rdquo;; the other set is &ldquo;Contour Points&rdquo; which define a contour and are calculated using a closed spline based on the control points.</p>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/segmentation/contourdefinition.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>To create a contour group (empty):</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Segmentations" in the SV project in Data Manager
Click "Create Contour Group" in the popup menu
Select Path: aorta
Group Name: (if blank, use path name by default)
Click "OK"
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/createemptygroup.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/creategroupdialog.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Now a new data node “aorta” for the contour group is created under the data node &ldquo;Segmentations&rdquo; in Data Manager. Double click the data node “aorta&quot; and the tool &ldquo;SV 2D Segmentation” automatically shows up. The new group is empty and has no coutours so far. At the same time, the layout of Display is changed, which has tree windows, and the image is resliced along the path. The left top window shows image reslices in intensity; the left bottom one shows reslices in the magnitude of intensity gradient; the right one shows intensity probe in 3D view. You can move the slider &quot;Reslice:&rdquo; to change reslice position. Click the button &ldquo;Size” to change the reslice size to make the whole vessel cross section is inside the reslice.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/segmentation/emptygroup.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
</section>
<section id="modelingThresholding" class="subgroup"><h3>Using Thresholding to Define a Contour</h3>

<p>Now let&rsquo;s use the threshold method to create and add contours to the group.</p>
<pre class="highlight plaintext"><code>Click the button "Threshold"
Two new panels show inside the tool
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/thresholdpanel.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The top new panel is to set a preset threshold value. The other new panel is for postprocessing and batch segmentation.</p>

<p>To create a contour using Threshold (interactively):</p>
<pre class="highlight plaintext"><code>Make sure toggle off the checkbox "Preset"  
Click the button "Threshold" when the threshold panel already shows.
The button is highlighted in light blue, which means the method is activated for interaction.
Move the cursor to a 2D view window
Press and hold the left mouse button at the center of vessel
Move the cursor up/down. Up: decrease threshold value, down: increase threshold value.
Relsease the left mouse button when you feel the contour (in yellow) matches the vessel lumen best
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/thresholdinteractive.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Notice when you move up/down, the slider &ldquo;Preset&rdquo; slider displays the threshold value used to create the contour. After releasing th mouse, the contour is finalized (in red) and added to the group. In this example, the preset value is 62.8. Under Contour List, the new contour is listed with the type and method used for it.</p>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/thresholdinteractive2.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>When this contour is finalized, two control points are created inside it for shifting and scaling the contour.</p>

<p>To shift a contour (interactively):</p>
<pre class="highlight plaintext"><code>Move the cursor to the central control point and it becomes red (activted)
Press and hold the left mouse button at the point
Move the mouse to shift the contour
</code></pre>

<p>To scale a contour (interactively):</p>
<pre class="highlight plaintext"><code>Move the cursor to the other control point (conncted to the central point by a short line)
Press and hold the left mouse button at the point
Move the mouse to scale the contour
</code></pre>

<p>The contour may looks a little jagged, you can selecte the contoru from the list and click the button &ldquo;Smooth&rdquo; to get a smooher contour.</p>

<p><figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/segmentation/smoothedcontour.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure></p>

<p>With the only two control points, we can&rsquo;t change the shape of the contour. Now we move the reslice position to 30 and create another contour using the same method as above. The only differences are:</p>
<pre class="highlight plaintext"><code>Move the reslice position to 30 
Toggle on the checkbox "Convert to Spline" in the threshold panel.
Ctrl No.: 12
</code></pre>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/segmentation/thresholdinteractive3.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>This time the finalized contour is converted a closed spline with 12 (Ctrl No.) control points along the contour, with two extra control points inside. Now you have severl ways to change the contour shape.</p>

<p>To move a control point (interactively):</p>
<pre class="highlight plaintext"><code>Move the cursor to a control point on the contour and it becomes red (activted)
Press and hold the left mouse button at the point
Move the cursor to adjust the point position on the reslice plane
</code></pre>

<p>To delete a control point (interactively):</p>
<pre class="highlight plaintext"><code>Move the cursor to a control point on the contour and it becomes red (activted)
Righ click
</code></pre>

<p>To add a new control point (interactively):</p>
<pre class="highlight plaintext"><code>Move the cursor to the contour line (but on any control points)
A green control point is created
Left click and the point is inserted into the contour.
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/addcontrolpoint.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>We can also create a contour using a preset threshold value, without interaction.</p>
<pre class="highlight plaintext"><code>Move the reslice position to 60 
Toggle on the checkbox "Preset" and set the value to 75, in the threshold panel.
Toggle on the checkbox "Convert to Spline" in the threshold panel.
Ctrl No.: 12
Click the button "Threshold"
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/thresholdpreset.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<h4>Batch Segmentation</h4>

<p>Now let&rsquo;s try  create contours in batch model using a preset threshold value.This approach involves pre-selecting the locations for the segmentations, so that only a handful of locations get segmented. This will be faster than generating all of the segmented contours at once. However, it requires user knowledge about which locations are important for the modeling, and it can be especially tedious for vessels with large curvature and/or radius changes. It may also require going back and segmenting other locations later in the process.</p>
<pre class="highlight plaintext"><code>Toggle on the checkbox "Preset" and set the value to 75, in the threshold panel.
Toggle on the checkbox "Convert to Spline" in the threshold panel.
Ctrl No.: 12
Toggle on the checkbox "Batch Mode", List: 80,100,130
Click the button "Threshold"
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/thresholdbatch.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Three more contours are created for reslice positions: 80,100,130. </p>
</section>
<section id="modelingLevelSet" class="subgroup"><h3>Using Level Sets to Define a Contour</h3>

<p>Thresholding is very dependent on the user-specified parameters and does not always result in a closed contour. An alternate method that’s been implemented within <strong>SimVascular</strong> is the level set method. <strong>SimVascular</strong> utilizes a specialized level set method built specifically for 2D vascular modeling. These level sets use to intensity image data and geometric constraints to produce a smooth contour of the vascular wall in 2D cross sections. <strong>SimVascular</strong>&rsquo;s level set method is initialized with a seed and then performs segmentation in two stages.  Details of these stages are outlined below.</p>

<h4>Seed Parameters</h4>

<p>These parameters modify the size of the starting seed. The size is standardized, and will be the same across all images. The location of the seed is fixed at the image center (path point)T</p>

<ul>
<li><strong>Radius</strong> controls the radius of the seed (an initialization circle or sphere).  Making sure the radius within the lumen of the vessel.</li>
</ul>

<h4>Stage 1 Parameters</h4>

<p>These parameters control the growth and stop criteria of the first stage levelset.  Stage 1 levelset is meant to arrive at a approximate solution to initialize stage 2. </p>

<ul>
<li><strong>Blur</strong> parameters control the image blur on the feature image and the advection image.  If your image has a lot of noise, increasing these values can improve accuracy. Increased image blur will decrease precision, however.</li>
<li><strong>Kthr</strong> is the equilibrium curvature value of the level set. A higher value will result in less curvature smoothing.</li>
</ul>

<h5>Advanced Features</h5>

<ul>
<li><strong>Exponent Factor Rise and Fall</strong> affect the speed of of the level set when rising on an image gradient, or falling.  A ratio of 1:2 is reccomended.</li>
<li><strong>Max Iterations</strong> specifies the maximum number of iterations that can be complete before levelset is halted.</li>
<li><strong>Max Error</strong> specifies the maximum RMS error for the levelset stop criteria.</li>
</ul>

<h4>Stage 2 Parameters</h4>

<p>Stage 2 level set is intended to provide a smooth, accurate contour based on the results of stage 1.</p>

<ul>
<li><strong>Blur</strong> parameters control the image blur on the feature image and the advection image. Similar to what discussed for stage 1, inceasing this value on images subject to a significant noise level may improve the accuracy of the resulting segmentation. Increased image blur will decrease percision, for this reason it is reccomended that blur settings be lower in stage 2 than in stage 1.</li>
<li><strong>Kupp</strong> and <strong>Klow</strong> specifies the maximum tolerable curvature. Unlike stage 1, where there is a equilbrium curvature, stage 2 has a specific allowable range for curvature.  When the curvature is too low the level set will grow/shrink the front to obtain a allowable curvature. <font color="orange"><strong>WARNING:</strong></font> If Klow is set too high, it may result in overshoot.</li>
</ul>

<h5>Advanced Features</h5>

<ul>
<li><strong>Max Iterations</strong> specifies the maximum number of iterations that can be complete before levelset is halted.</li>
<li><strong>Max Error</strong> specifies the maximum RMS error for the levelset stop criteria.</li>
</ul>

<p>Now let&rsquo;s use the levelset method to create and add contours to the group.</p>
<pre class="highlight plaintext"><code>Click the button "LevelSet"
A new panel shows inside the tool
</code></pre>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/levelsetpanel.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The new panel is to set parameters for the levelset.</p>

<p>To create a contour using Levelset:</p>
<pre class="highlight plaintext"><code>Move the reslice position to 158
Use default levelset paramters
Toggle on the checkbox "Convert to Spline" in the threshold panel.
Ctrl No.: 12
Toggle off the checkbox "Batch Mode"
Click the button "LevelSet"
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/levelset.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Now a new contour is created and added to the group.</p>

<h4>Batch Segmentation</h4>

<p>In general, you should go with the normal approach above: making more segmentations than you will need and then selecting a subset to define the vessel. However, in the following exercise, we will try to gain some intuition that makes batch level set segmentation possible and efficient.</p>

<p><font color="red"><strong>HELPFUL HINT:</strong></font> Finding suitable level set parameters based on a few cross sections and then doing batch segmentation can dramatically speed up model building. Make sure the seed fits within the lumen of the vessel for all the positions we’d like to segment in the batch. </p>

<p>Now let&rsquo;s try  create contours in batch model using levelset. </p>
<pre class="highlight plaintext"><code>Toggle on the checkbox "Convert to Spline" in the threshold panel.
Ctrl No.: 12
Toggle on the checkbox "Batch Mode", List: 180:30:600
Click the button "LevelSet"
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/levelsetbatch.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Three more contours are created for reslice positions: 180,210,240,270,300,330,&hellip;,600. After batch segmentation, it is good practice to quicly check through them paying attention to possibly unclosed and inaccuate segmentations.</p>

<p>Here are some helpful hints for checking out your contours that you have created in batch mode:</p>

<p>First, check to see that the contours are in the center of the “donut” in the potential window. An example of a contour that is in the center of the potential window “donut” is shown below:</p>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/batchexample1.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>If the contour is not exactly in the center of the donut (like the example shown below), you can scale it using the control point.</p>

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/batchexample2.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Secondly, you want to check to make sure that the segmentation does not include a branch vessel, like the example shown below.  Although the level set method can segment these, including these in your final model will cause an artificial geometry know as a “lofting artifact.” </p>

<!-- You can fix these types of segmentations using the techniques described in [Section: Copying and Pasting Contours](#modelingCopyingPastingContours). -->

<figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/batchexample3.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font>   You want the spacing between locations to be sufficient to capture the curvature and other changes in the vessel.  If the vessel is relatively straight, as is the case in this the abdominal aorta for this dataset, you can space the segmentations relatively far apart.</p>
</section>
<section id="modelingLoftingPreview" class="subgroup"><h3>Lofting Preview</h3>

<p>To check the quality of the contour group, which later will be lofted to create a 3D model, we can preview the lofted surface based on the group of contours. </p>
<pre class="highlight plaintext"><code>Toggle on the checkbox "Lofting Preview" 
</code></pre>

<figure>
  <img class="svImg svImgLg"  src="documentation/modeling/imgs/segmentation/loftingpreview.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>A new data node named &ldquo;Lofted&rdquo; for the lofted surface is added under the data node &ldquo;aorta&rdquo; for the group. As you add/remove/modify contours, the surface will be udpated automatically.</p>

<p><font color="red"><strong>HELPFUL HINT:</strong></font> This step is especially important for discrete (PolyData) modelling later.If the lofted surface doesn&rsquo;t match the vessle you are modeling, you can change some paramters to improve it.</p>

<p>There are several parameters you can change for lofting.</p>
<pre class="highlight plaintext"><code>Click the button "Options..."
</code></pre>

<p><figure>
  <img class="svImg svImgSm"  src="documentation/modeling/imgs/segmentation/loftingdialog.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure></p>

<p>Changing the parameters can drastically change the shape and smoothness of your model surface. </p>

<ol>
<li><p>The &ldquo;Sampling&rdquo;  indicates the number of points that will be used to represent the circumference of each segmentation. The higher the number, the smoother the face of the model will be with respect to the circumference. The Default is 60 but more or less can be used depending on the size and complexity of the vessel. A smaller vessel needs less points around the circumference compared to a large vessel.</p></li>
<li><p>The &ldquo;Number of Points Per Segment&rdquo; sets the number of points to be used to create the segment between each segmentation. This creates points between two circumferential points created above. The points are joined to create a solid model. A higher number for this field would result in a smoother model but takes longer to render. The default is set at 12 but numbers upwards of 50 can be used with success for a smoother model.</p></li>
<li><p>Linear Sample Along Length: When this is checked on, the amount of triangles created between each segmentation is uniform. When off, the number of triangles is proportional to the length between the segmentations. The default Factor: 10 should be sufficient for most modeling. </p></li>
</ol>
</section>
<section id="modelingManual" class="subgroup"><h3>Segmenting an Image Manually</h3>

<p>Sometimes it is not possible to use automated techniques to segment an image. Other times, automatic techniques work, but yield poor contours. In these situations, you may need to segment the image manually. SimVascular provide several options: circle, ellipse, spline polygon, polygon.</p>

<h4>Circle</h4>

<p>To create a circle (interactively):</p>
<pre class="highlight plaintext"><code>Click the button "Circle"
The button is highlighted in light blue, which means the method is activated for interaction.
Move the cursor to a 2D view window
Left click at the vessel center
Move the cusor away from the center.
A circle shows up. It keeps changing the radius as you move the cursor.
Left click again. The circle is placed.
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/segmentation/circle.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The circular coutour has only two control points, one is for shifting and the other is for changing radius.</p>

<h4>Ellipse</h4>

<p>To create a ellipse (interactively):</p>
<pre class="highlight plaintext"><code>Click the button "Ellipse"
The button is highlighted in light blue, which means the method is activated for interaction.
Move the cursor to a 2D view window
Left click at the vessel center
Move the cusor away from the center.
An ellipse shows up as a circle initially. It keeps changing the radius as you move the cursor.
Left click again. The ellipse is placed.
</code></pre>

<p>The elliptical coutour has four control points. The two points on the contour line are for adjusting the orientation and size of the major and minor axes.</p>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/segmentation/ellipse.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<h4>Spline Polygon</h4>

<p>A spline polyon is composed of multiple points and the adjacent points are connected by a closed spline.</p>

<p>To create a polygon with a spline (interactively):</p>
<pre class="highlight plaintext"><code>Click the button "SplinePoly"
The button is highlighted in light blue, which means the method is activated for interaction.
Move the cursor to a 2D view window
Left click at the vessel edge and a control point is added.
Move the cusor clockwise or anticlockwise along the edget and left click; a second control point is added.
Repeat the step above before the last point.
Double click for the last point. The contour is completed and placed. 
</code></pre>

<p>After the contour is finished. You can continue to modify it, by shifting, scaling, or moving/adding/deleting points.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/segmentation/splinepoly.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>To create a normal polygon, use the same way as above. The only difference is that the adjacent points are connected by straight lines. </p>
</section>
<section id="modelingImportingExportingGroups" class="subgroup"><h3>Importing and Exporting Contour Groups in Legacy Formats</h3>

<p><strong>Importing Groups:</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Segmentations" in the SV project in Data Manager
Click "Load Legacy  Segmentations" in the popup menu
Select a directory you would like to load, and click the “Choose” button.
</code></pre>

<p><strong>Exporting Groups:</strong></p>
<pre class="highlight plaintext"><code>Right click the data node "Segmentations" in the SV project in Data Manager
Click "Save Legacy  Segmentations" in the popup menu
Select a directory you would like to save, and click the “Choose” button.
</code></pre>
</section>
<section id="modelingSolidModeling" class="group"><h2>Creating a Solid Model from 2-D Segmentations</h2>

<p>In the previous section, it was shown how to create individual 2-D segmentations along a particular vessel path.  It is worthwhile to reinforce at this point the distinction between visualizing geometry and utilizing geometry for numerical simulation.  If you were to graphically display all the segmentations that you created in the previous exercise, your mind may “connect the dots” and create a 3-D mental image of the geometry.  However, we need to create a 3-D solid model that the computer can understand.</p>

<p>Fortunately for us, an ordered relationship between some of the curves is known.  That is, for each path we have an ordered set of curves defining the geometry for the given vessel.  These sets are the groups that we have used to organize the segmentations. All of the segmentations are associated with one and only one vessel.  This motivates a two-stage process to create a solid model.  First, a “lofted” solid is created for each branch.  This results in a collection of solid branches.  Second, a boolean addition (union) is performed of the individual branches.  The result is then a single bounded solid region representing the blood flow domain.</p>

<p>In this section we will explore these two steps.  In <a href="#modelingCreatingModels">Section: Using Groups of Segmentations to Create Solid Models</a>, a single branch is lofted from a set of curves.  In <a href="#modelingCreatingBranch">Section: Creating a Branch Vessel</a>, we will perform a boolean addition to create a single solid model. <a href="#modelingBlending">Section: Blending the Junction of Two Vessels</a> shows you how to smooth out the intersection between vessels.</p>
</section>
<section id="modelingCreatingModels" class="subgroup"><h3>Using Groups of Segmentations to Create Solid Models</h3>

<p>This exercise will assume that you have completed <a href="#modelingPuttingTogether">Section: Putting It All Together</a> and that you have created segmentations down the aorta and common iliac artery that you can now “loft” together to form solid model.</p>

<p>The first thing we will do is create a new group “aorta_test” that mimics your original group, “aorta”. We will do this so that we can manipulate (i.e., delete) contours in this group without affecting the original group. Review <a href="#modelingUsingGroups">Section: Using Groups</a>, <a href="#modelingAddingToGroup">Section: Adding Contours to a Group</a>, and <a href="#modelingBatch">Section: Creating and Modifying Segmentations in Batches</a> and create a group named “aorta_test” that contains all of the segmentations that are found in the group “aorta”.</p>

<p>Then, under the “2D Segmentation” tab:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/1.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Highlight “aorta_test” in the group treeview display window. Next to the group treeview display window, click on the “Model Operations → Use Surface” button under “Operations” on the right hand side of the screen. After this button is pressed, you should see a “X” appear in the column “Use in Model” next to “aorta_test” in the group treeview window. This indicates that you would like to loft a 3D solid from the group “aorta_test”.</p>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font> You can only use Parasolid to generate a model if you have paid for a Parasolid license and have the licensed portion of the software. If you do, you can activate the Parasolid tab by going to the &ldquo;Work Menus&rdquo; selection in the upper left hand of your screen and selecting Parasolid. </p>

<p>Under the “Model → Parasolid → Create Model” tab, click on the “Create Pre-Op Solid Model” button. A window will appear asking you to name your new model. Name your model &ldquo;NewModel&rdquo; and then click &ldquo;Enter&rdquo;. You may not give a blank name, a name containing &ldquo;.&rdquo;, or a name containing &ldquo;/&rdquo;. Another window will appear asking you if you would like to “Recreate all solids”. Click on the “Yes” button. Another window appears asking if you would like to “Create missing solids using defaults.” Click on the “Yes” button. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/2.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>A box will pop up informing you that it is renaming one of the surfaces so that you do not have two surfaces with the same name. Then, a red solid representing your vessel should appear.</p>

<p>In addition, the name of the solid will appear underneath Parasolid in the dropdown list. The model should also have faces corresponding to the groups used to create the solid. Click on the model name to expand the list and see the faces.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/2.5.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The “num sample pts” under “Segmentation → Lofting Parameters” describes how many sample points around each segmentation are used to connect one contour to the adjacent contour. You can imagine that using fewer sample points creates a more smooth model, but one that may not adhere as well to the 2D segmentations. You are encouraged to play around with the option. Change the value in “num sample pts” and click on the “Create Pre-Op Solid Model” button to see how it affects the solid.</p>

<p>Now, let’s examine the solid in more detail. Click your mouse in the 3D display window and click on the semi-transparent solid model. If you type “p” on the keyboard, the model should now become opaque yellow and easier to visualize. If you would like to change the opacity of the lofted solid (optional), “pick” the 3D solid, which turns it opaque and yellow, and go to the “Visualization” portion on the right hand side of the screen. Click “Color and Opacity → Change Selected Opacity” and choose a desired opacity. Use this same button and click &ldquo;Change Selected Color&rdquo; to change the color of the model. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/3.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Whether or not you have decided to make your solid model opaque by changing its actor properties, zoom in and examine the features of your model. In our example model, we can see that we have a segmentation that creates a bump in the vessel, most likely because there is a branch coming off at that point.</p>

<p>Let’s try to fix the model by deleting the segmentation and re-lofting it. First, hide your lofted model by going to the &ldquo;Model Visualization → Do Not Display Model&rdquo;. To delete the segmentation, navigate back to the “Segmentation → 2D Segmentation” tab.</p>

<p>In the group treeview display window, highlight the group “aorta_test”. To the right of the treeview display window, under “Visualization”, click on the “Display Groups” button. A new window will open, asking you to select a color to display your group in. We have selected bright green:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/4.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Right away we can see which segmentation was problematic. Pick this segmentation by clicking inside the 3D display window, placing your mouse over the segmentation, and typing “p” on the keyboard. Two things should happen – the contour will be highlighted in yellow in the 3D display window, and the path point which it corresponds to will be highlighted in blue in the group treeview display window:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/5.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>To delete this segmentation, simply click the “Delete Members” button located to the right of the group treeview display, under the heading “Member Operations”.</p>

<p>If you clear the 3D display window by going to “Group Visualization → Do Not Display Group” and the re-display the group by clicking on the “Group Visualization → Display Groups” button, you should see that the segmentation that you just deleted is now missing. Its corresponding pathpoint should also be missing from your group treeview display window.</p>

<p>We will now re-loft the model again. Click on the “aorta_test” group in the treeview window and then click on the “Use Groups” button under the “Solid Model Lofting” header that is to the right of the treeview window. Again you should see the word, “YES” next to the “aorta_test” group name in the treeview window. </p>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font> You will have to select the group for lofting by clicking the “Use Group” button and re-loft the model every time you make modifications to the group. </p>

<p>Now, re-loft the model by clicking on the “Create Pre-Op Solid Model” button under the “Model → Parasolid → Create Model” tab. Did deleting the segmentation help? You can use the Display Options pane to turn on visualization options that will help you judge the fidelity of your solid model. For example, try turning on the “S/I” slider bar and running up and down the 3D solid. How well does it represent the imaging data? You can see that this is one time when it is useful to leave the lofted vessel in a semi-transparent state:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/6.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Changing the rendering resolution:</strong></p>

<p>Next, we will learn about the difference between true lofting artifacts and visualization artifacts. Zoom in on the iliac branch and check for lofting artifacts. Click on the model and type “p” to select the model and turn it opaque. You might see something like following. Is this a lofting artifact?</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/7.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>The answer is no. The crease you see in the picture above results from the resolution of the rendering. This can easily be fixed by changing the maximum facet size.</p>

<p>In the Functional Toolbox pane, click on the “Displays” tab and then click on the “General” tab. You will find a number of options that you can use to change the way things are displayed in your display windows. Next to “Facet Max Edge Size:”, you will see that the default is “1.0”. </p>

<p>Type in “0.1” in the place of “1.0” and hit RETURN.</p>

<p>With your solid model “picked” (opaque yellow), under visualization on the right hand side, click &ldquo;Model Operations → Copy Model&rdquo;. Give a name for your new visualized model. Now, every time a Parasolid object is displayed on screen, it will be created with facet sizes with a maximum of 0.1 units. This will display the model with smaller faces and give you a smoother looking surface. You should see that the creases have disappeared:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_models/8.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Fixing Segmentations that Cause Lofting Artifacts:</strong></p>

<p>Now that you have an acceptable maximum facet size, take a close look at the model. You should be able to take care of lofting artifacts using the techniques demonstrated in <a href="#modelingCopyingPastingContours">Section: Copying and Pasting Contours</a> and <a href="#modelingModifyingContours">Section: Modifying Contours</a>.</p>

<p>For the purposes of this exercise, it is suggested that when you modify contours or create new ones, you should add them both to the “aorta” and “aorta_test” group. Treat the “aorta” group as a running history of all available contours in case you need to draw from those again. Meanwhile, create your models from the “aorta_test” group and add and delete segmentations freely from this group.</p>

<p>Here are a few suggestions for fixing common problems:</p>

<ol>
<li><p>Your segmentation includes a branch artery. As we saw above, it is easy to just go ahead and delete this segmentation and re-loft your model without it. However, sometimes it is necessary to add in a contour near that location to make the model more true to the imaging data. In these cases, consider copying and pasting a nearby contour (<a href="#modelingCopyingPastingContours">Section: Copying and Pasting Contours</a>) or hand drawing a contour in a manner that does NOT include the branching portion (<a href="#modelingManual">Section: Segmenting an Image Manually</a>). Drawing by hand will require a bit of artistic license.</p></li>
<li><p>The solid model of your branch vessel seems “bumpy”. If you have created level set segmentations in the iliac branch of the vessel and then fit circles to these segmentations, you may find your model looking something like this:</p></li>
</ol>

<figure>
  <img class="svImg svImgMd"  src="documentation/modeling/imgs/solid_modeling/creating_models/9.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>This is because the segmentations in this region are close together and not quite the same size. For small vessels, small differences in the level set segmentations can translate to big differences in area. Consider fixing this problem by either removing segmentations or copying and pasting a single contour down the length of the branch vessel. Copying and pasting a single contour is really only appropriate in the branch vessels, which are relatively far from the region of interest. This methodology may be justified using the shear stress autoregulation theory, which states that vessels will adjust their size to maintain relatively constant levels of shear stress. Thus, as long the flow remains constant along a given small segment of vessel, the vessel should remain about the same diameter for the given small segment. The exception, of course, is if the branch vessels have disease such as atherosclerosis or aneurysm. </p>

<p>When you are happy with the solid model you have created, don’t forget to “Save Groups” in the File menu. Also save your model with &ldquo;File Input/Outpu → Save Model&rdquo;.</p>
</section>
<section id="modelingCreatingBranch" class="subgroup"><h3>Creating a Branch Vessel</h3>

<p>To create a model of the entire human abdominal aorta, the aorta and its branch vessels will need to be joined together. For the purposes of this tutorial, we will focus on adding the right common and external iliac to the vessel that you just created, which includes the main trunk of the aorta and the left external iliac artery.</p>

<p>It is not immediately obvious how best to create a branch vessel so that we end up with a desirable model, so the purpose of this exercise is to teach you some tricks that you may find useful. This exercise will also describe some of the common pitfalls in branch vessel creation.</p>

<p>Follow the instructions in <a href="#modelingPathPlanning">Section: Path Planning</a> to create a path for the right iliac artery. Make sure that your path overlaps the path that we created for the aorta:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/1.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>When you have created your path, follow the instructions in <a href="#modelingSegmentation">Section: Segmentation</a> to create contours down this path. </p>

<p>Here are some tips for creating the first few segmentations, which may be the most important in creating a branch vessel that is easily joined to another one. Start by lofting together the solid model that you created for the aorta and left iliac artery in <a href="#modelingCreatingModels">Section: Using Groups of Segmentations to Create Solid Models</a>.</p>

<p>Then change to the path you’ve just created for the right iliac artery under the “2D Segmentation → Create Vessel” tabs, and create a new group called “right_iliac” for this branch vessel.</p>

<p>Move the current position slider bar just above the bifurcation point. Segment this position using level set methods and Fourier smooth it. You may find that your segmentation looks something like this:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/2.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>What is wrong with this segmentation (shown in blue in the 3D display window)? You will notice that part of it is not enclosed in the solid model of the aorta that we generated. You can imagine that this will cause problems when we join the two vessels together because it will create a “ledge” that juts out of the aorta.</p>

<p>You already know of a number of ways to fix this first segmentation so that it fits completely within the main aorta vessel we created earlier, but now we will demonstrate another one. Start by adding this segmentation to the group “right_iliac”. Now, highlight this segmentation in the group treeview display and click on the “Manipulate” drop-down menu in the sidebar to the right of the group treeview display. Select “Show Spline” and “Show Image”:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/3.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>A yellow segmentation should appear on top of your blue one. If you click on this ring and try to move it, you will see a number of grey spheres appear. These are handles that you can use to adjust the shape of the segmentation. Click on sphere with your left mouse button and drag it to see how the segmentation changes. If you click on a part of the yellow segmentation in between the grey spheres, it should turn green and you can then translate it within the plane. If you do not like the changes you have made to your segmentation, you can choose “Refresh Spline” (highlighted in blue) in the “Manipulate” drop-down menu to the right of the group treeview window.</p>

<p>If you are happy with your new segmentation, choose “Replace Seg with Spline” in the “Manipulate” drop-down menu. </p>

<p>Now let’s move on to the second segmentation in the bifurcation. It is only crucial that the first segmentation fit completely within the main trunk in order to prevent the ledge effect described earlier, so we can rest easy when we are sure that is the case.</p>

<p>Move down a few slices, and segment this portion of the vessel using level set techniques and then Fourier Smooth it. You may end up with something like this:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/4.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>You’ll notice that the segmentation shown in the 3D display window above does not fall completely within the bounds of the main aorta solid model. This is okay – we will discover what effect this has on the overall model in just a bit. If you are happy with your segmentation, add it to your group.</p>

<p>Continue segmenting down your vessel until you are clear past the bifurcation, adding your segmentations to the group “right_iliac” along the way. In order to properly represent the bifurcation, it is important to get a contour as close to the point where the vessel has split off completely as possible.</p>

<p>Once you’ve cleared the bifurcation, we can start to see how you’re doing. Highlight all of the segmentations you have just made in the group treeview display window by holding down the “shift” key while clicking with your left mouse button. Click on the “Manipulate” drop-down menu to the right of the group treeview display and select “Align All Profiles”. After the profiles have been aligned, click on “Show Surface” in the “Manipulate” drop-down menu. A solid red surface made with your new segmentations should now appear. Click your mouse in the 3D display window and, while your mouse is over the semi-transparent solid model of the aorta, type “p” on the keyboard. The main branch of the aorta should now turn solid yellow: </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/5.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Fly around in the 3D window and examine the junction. Because your first segmentation should be housed completely within the main branch of the aorta, you should not observe any sharp ledges where the first segmentation juts out of the aorta. Do you?</p>

<p>What happens where your segmentations are partly inside and partly outside of the main branch of the aorta? Are there smooth transitions there?</p>

<p>Perhaps you have constructed your branch vessel such that most of your segmentations were inside the main branch of the aorta until after the bifurcation, and the joined pieces look more like the following:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/creating_branch/6.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>This can work as well. However, you will notice that you may find a slight “bump” where the right iliac comes out of the aorta (shown with the green arrow in the picture above). This type of junction may not be quite as smooth as what is shown on the previous page. However, you will learn how to fix this in <a href="#modelingBlending">Section: Blending the Junction of Two Vessels</a>. </p>

<p>For now, use the new skills you’ve learned in this exercise along with the techniques you learned in the previous section to complete contour creation down the length of the right iliac artery. As with the aorta branch, you may want to fit circles down where the right iliac becomes much smaller.</p>
</section>
<section id="modelingJoining" class="subgroup"><h3>Joining Vessels Together to Create a Model</h3>

<p>Once you’ve finished creating the right iliac branch, you will find that it is quite easy to join it to the aorta and make a solid model.</p>

<p>In the group treeview display window, select the groups that you would like to use to create a model and click on the “Use Groups” button under “Solid Model Lofting” to the right of the group treeview display window. Once you have chosen the groups you would like to include in your model (one for the aorta, one for the right iliac), they should have “X” written next to them in the “Use in Model” column of the group treeview display.</p>

<figure>
  <img class="svImg svImgXl" src="documentation/modeling/imgs/solid_modeling/joining/1.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Under the “Model → Parasolid → Create Model” tab, click on the “Create Pre-Op Solid” button. Once again, give the model a name. After creating the model, it is possible to save by going to &ldquo;File Input/Output → Save Model&rdquo;. Choose a file location and the extension .xmt_txt should automatically be added designating it as a Parasolid model.</p>

<figure>
  <img class="svImg svImgXl" src="documentation/modeling/imgs/solid_modeling/joining/2.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>If you zoom into the bifurcation area of the model, you will find the seam where the two solids were united. You will learn how to smooth out this seam in the next section.You can once again change colors of specific regions by hovering over the solid with your mouse and pressing &ldquo;p&rdquo;. This will highlight the selected face in the list view. You can then change the color and opacity as before.</p>
</section>
<section id="modelingBlending" class="subgroup"><h3>Blending the Junction of Two Vessels</h3>

<p>The idea behind blending two faces of a model together is similar to sweeping a clay sphere of a certain radius all along the seam to “fill in the cracks” and make it smoother. In order to blend your model, you will first have to know the names of the faces you will be blending.</p>

<p>You should have two faces whose names start with “wall” followed by the group names. By clicking on these names in the list, they will highlight the respective wall in the 3-D window to insure that you are in fact blendign 
For each of these “wall” faces, click on the “Change Color” button and choose a different color for them. This will ensure that the walls you are choosing to blend are what you think they are.</p>

<p>In our case, the two walls we would like to blend are named “wall<em>aorta</em>test” and “wall<em>right</em>iliac”. Take note of these names. We have changed the surfaces to be pink and sky blue, respectively:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/blending/1.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Now is also a good time to change the names of all the faces to be more descriptive. Change the name of the pink and sky blue surfaces to be “wall<em>aorta</em>test” and “wall<em>right</em>iliac,” if they do not already have those names. In the figure below, we have changed the color of the face that we will name “inflow<em>aorta</em>test” to yellow, “outflow<em>aorta</em>test” to green, and “outflow<em>right</em>iliac” to blue as shown below. To change the name of each face, click on the corresponding “Face Id”, type in the corresponding name in the “surf name:” field, and click the “Set Value” button. For future reference, the names of the faces are case sensitive so try to be consistent when capitalizing. We recommend that you use only lower case letters in your face names.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/blending/2.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Next, navigate to the “Model → Parasolid → Blend Model” tab. Click your model in the list, and this designates that this model will be used for the blending operations.</p>

<p>In the bottom frame of the “Blend Model” tab, you will find a field with three columns, labeled “face 1”, “face 2”, and radius. Type in the two names of the “wall” faces you would like to blend, and then type in “0.3” for the radius. At least one space must be separating each of these typed fields.</p>

<p>When you are done, click on the “Blend Model” button. Your previous model will be cleared from the screen and your new blended model should now appear. Zoom in to the bifurcation area. You can highlight the blended surface by putting your mouse over it and typing “p” on the keyboard to turn it yellow:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/blending/3.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>You’ll see how blending the model created a surface that “smoothed over” the previous seam. What happens when you choose a different radius for blending?  Play around with different values for the radius, clicking undo, and then trying a new value.</p>

<p>Note: If there is a case where the “blending sphere” radius is such that it intersects a wall twice (you have a very tight junction), the two walls will not blend. Try decreasing the radius in these cases.</p>

<p>When you are satisfied with the level of blending you have chosen for your model, click on the “Save” button to save this model:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/solid_modeling/blending/4.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
</section>
<section id="modelingSolidModelingPolyData" class="group"><h2>Creating a Solid Model with PolyData</h2>

<p>In the previous section, it was shown how to create a solid model using Parasolid software. The PolyData software combines the created set of groups differently than Parasolid, through an ordered Boolean Addition. Each group of segmentations respresents a vessel and these are placed in a ordered list. The first of these ordered groups of segmentations is lofted with the second and each subsequent group is lofted to this growing union until the model is complete.</p>

<p><strong>Preparing for Modeling:</strong></p>

<p>Before creating a solid from your groups, it is important to inspect the groups you have created. To view your groups, navigate to the 2D Segmentation tab, highlight the groups you wish to view and click Display Groups in the Visualization Menu to the right. A good set of groups:</p>

<ol>
<li><p>Has been created from smooth, overlapping paths: a jagged or bumpy path can lead to segmentations with greatly differing angles making it difficult to combine them in a Boolean Addition. A path that is too short may cause a gap resulting in some segmentations not being joined at all</p></li>
<li><p>Has reasonably spaced segmentations: too many segmentations can result in a jagged solid or many ridges and could cause problems when attempting to mesh. There should be enough to get the general shape and curves of the vessel, with segmentations denser around curves and more spread out when the shape is essentially a straight cylinder.</p></li>
<li><p>Has smooth transistions between groups: two vessels being joined should share a common space. The first segmentation on a branch vessel should be completely contained by the solid model to be created by the main vessel. For example, the first segmentation for right iliac should be contained completely by the aorta. If not, a ledge could be created, complicating future steps.</p></li>
</ol>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font> <strong>Some Useful Keyboard Shortcuts:</strong></p>
<pre class="highlight plaintext"><code>Hover the cursor over the Display Window and press the following:
    w - view the model as a wire mesh
    s - view the model as a solid
    e - view the edges of the triangulated mesh on the solid model:
Hover over the desired area and press:
    p - to “pick” or select the model, highlighting it yellow for a better visualization
    c - to “choose” and highlight a cell to be modified or deleted
</code></pre>
</section>
<section id="modelingCreatingModelsPolyData" class="subgroup"><h3>Creating a PolyData Model from 2D Segmentations</h3>

<p>This exercise will assume that you have completed <a href="#modelingPuttingTogether">Section: Putting It All Together</a> and have created segmentations down the aorta and common iliac artery that you can now use to create a solid model.</p>

<p>Make sure the paths and groups you intend to model have been loaded.</p>

<p>Navigate to the 2D Segmentation Tab and Display your groups.</p>

<p>Navigate to the “Segmentation” tab in the functional toolbox. Under the Operations portion of the right hand side of the window, select the &ldquo;Model Operations → Use Surface&rdquo;. This will put an &ldquo;X&rdquo; in the portion of the list that says &ldquo;Use in Model&rdquo;. This will designate the surface as a surface to be used in the Boolean to create a full model.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/creating_models/selectingOrderedGroups.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Now navigate to the &ldquo;Model → PolyData → Create Model&rdquo; and click the button called &ldquo;Create Pre-Op Solid Model&rdquo;.
A window will pop up asking what you would like to create a model. Name your model and click &ldquo;Enter&rdquo;. You may not give a blank name, a name containing &ldquo;.&rdquo;, or a name containing &ldquo;/&rdquo;.</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/creating_models/namingNewModel.jpg"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Your completed model should look something like this:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/creating_models/Boolean.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Boolean Options:</strong></p>

<p>Changing the parameters for the Boolean Union can drastically change the shape and smoothness of your model. To do this, navigate to the &ldquo;Segmentation → Lofting Parameters&rdquo; tab.</p>

<ol>
<li><p>The &ldquo;Sampling&rdquo; box under &ldquo;Circumferential Sampling Rules&rdquo; indicates the number of points that will be used to represent the circumference of each segmentation. The higher the number, the smoother the face of the model will be with respect to the circumference. The Default is 30 but more or less can be used depending on the size and complexity of the vessel. A smaller vessel needs less points around the circumference compared to a large vessel.</p></li>
<li><p>The &ldquo;Number of Points Per Segment&rdquo; box under &ldquo;Longitdunial Sampling Rules&rdquo; sets the number of points to be used to create the segment between each segmentation. This creates points between two circumferential points created above. The points are joined to create a solid model. A higher number for this field would result in a smoother model but takes longer to render. The default is set at 6 but numbers upwards of 50 can be used with success for a smoother model.</p></li>
<li><p>Linear Sample Along Length: When this is checked on, the amount of triangles created between each segmentation is uniform. When off, the number of triangles is proportional to the length between the segmentations. The default Factor: 10 should be sufficient for most modeling. </p></li>
</ol>

<p><strong>Saving and Viewing the created PolyData Model:</strong></p>

<p>To save the model, click “File Input/Output → Save Model” on the top right, select the correct directory and save the model as “demo.vtp” ensuring it is a “.vtp” file.</p>

<p><font color="red"><strong>HELPFUL HINT:</strong> </font> <strong>Boolean Solid:</strong>
At the end of the Boolean operation, a window pop up will display the number of free edges and bad cells on the surfaces. Bad cells are denoted by triangles that have more than one neighbor which should not be possible if you have a valid 3D surface. If these numbers are not zero, please report this occurence to the SimVascular development team.  </p>

<p>In addition, you should now be able to see the face names retained from your group segmentations. There should be wall and cap surfaces. If there are two caps for a surface, this means that after lofting, this surface had two holes. For a typical model, you should have one vessel like this and the rest should have one cap. If you have two caps, it may be the case that one of your vessels does not completely intersect into another vessel.</p>
</section>
<section id="modelingPolyDataFaces" class="subgroup"><h3>Creating and Naming PolyData Model Faces</h3>

<p><strong>Extracting Faces:</strong></p>

<p>Under &ldquo;Model → PolyData&rdquo; navigate to the “Face Manipulation” tab. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/faces/prenamedFaces.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>However,if you would like to have one wall surface, under “Boundary Extraction” set the angle of separation to around 50 degrees and click &ldquo;Extract Boundaries&rdquo;.</p>

<p>A list of the model faces found will appear in the window to the right.</p>

<p>If the number of faces listed does not match the number of faces expected, you must toggle the extraction angle to get the desired number. After extracting the faces, hover over a surface in the window and select &ldquo;p&rdquo;. Alternatively, select the face from the model in the list. Either of these methods will highlight your face in the 3D window. The key here is to make sure that the caps of your vessels are isolated from the other surfaces of your vessel. Once this is done, follow the direction below to &ldquo;Select and Combine Faces&rdquo;. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/faces/Selection.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Naming Faces:</strong></p>

<p>In order to rename a face, find the box called &ldquo;surf name: &rdquo; above the Object list.</p>
<pre class="highlight plaintext"><code>    1. Pick the inflow face by hovering over it with the mouse and pressing “p” on the keyboard
    2. Go to “surf name” box and type in “inflow_aorta”
    3. Do the same with the outflow faces of the left iliac artery naming “outflow_left_iliac”
    4. “pick” the face of the model (pick anywhere on model) and name this face “all_wall”
</code></pre>

<p>Naming the wall of the model:</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/faces/Naming.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Combining and Deleting Faces:</strong></p>

<p>If there are excess faces other than the ones named, and toggling the boundary extraction angle did not yield your desired results, attempt to highlight each to find the face it should be a part of. To further identify faces, select the Face ID, click “Color and Opacity → Change Selected Color” and select a color. The face should change to the selected color in the viewing window.      </p>
<pre class="highlight plaintext"><code>    1. In the window highlight "all_wall" and any unamed faces. This can be easily done by holding "Shift" and clicking the first and last names or by holding "Ctrl" and clicking on the desired names.
    2. Choose “Select and Combine Faces”
3. The 
    3. Click “Save Model” under "File Input/Output" to save model. You can rename this “demo_named” if want to keep the old vtp model
    4. Now we only have boundaries where we want them (total of 4)
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/faces/Combining.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>If necessary you can delete unwanted faces:</p>
<pre class="highlight plaintext"><code>    Select and Delete Faces —&gt; Highlight faces in the window and click the button.
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/faces/Deleting.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p><strong>Selecting and Remeshing Faces:</strong></p>

<p>If you would like to improve the quality of the surfaces on your mesh prior to meshing, this is possible in both the PolyData tab and the Meshing tab. In order to remesh the surface in the PolyData tab, you must select a mesh edge size that will give a reasonable surface mesh, highlight the faces you would like to remesh and then select &ldquo;Select and Remesh Faces&rdquo;. This will take a while, as it must preserve the boundaries between surfaces, so be patient. </p>

<p><strong>Filling Holes with Ids:</strong></p>

<p>After deleting some faces of the model, it may be desirable to keep the current names of the other surfaces in the model. In this case, select &ldquo;Fill Holes with Ids&rdquo; and this will fill in the holes of the model. For each new surface created, a new id number will be assigned. It is possible to name these surfaces to your liking following the instructions above for &ldquo;Naming Faces&rdquo;.</p>
</section>
<section id="modelingEditingPolyData" class="subgroup"><h3>Editing a PolyData Model</h3>

<p>In order to select and delete cells, make sure the model is being visualized as a full surface. This will insure that the cells are deleted from the actual model. </p>

<p><strong>Deleting Cells:</strong></p>

<p>If there is a unwanted bump or rough part of the model, specific cells can be selected and deleted and the hole created filled to create a smoother model. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/editing/selectingCells.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
<pre class="highlight plaintext"><code>    Navigate to “Model → PolyData” → “Delete Cells”
    Press “e” while hovering over the model in the view window to view the edges of the triangulated surface
    Select cells to be deleted by hovering over them and pressing “c”. 
    Pressing “C” (Shift - c) will select multiple cells at the same time
    “Delete Selected Cells” will delete these cells, making a hole in the model.
    “Fill Holes” will fill in this hole with a triangulated mesh surface.
    The goal is to create a new surface that is smoother than the section just deleted.
</code></pre>

<p><strong>Smoothing a PolyData Model (Global):</strong></p>

<p>Navigate to &ldquo;Model → PolyData → Global Ops&rdquo;</p>

<p>Selecting any of the following surface operators will edit the entire surface of the model</p>

<p>Surface Operators summary:</p>
<pre class="highlight plaintext"><code>    Smooth Poly Data Model: 
            smooths the bumps and ridges of the model
            Laplacian Smooth -&gt; Relax Factor -&gt; Choose between .01 and .05 


    Butterfly Subdivision:
            Divides the meshing triangles based on number placed in “Num Divisions”
            For example, to divide each triangle in half: Num Divisions = 1
            This creates a finer mesh made up of smaller triangles


    Decimate Surface:
            Based on target rate, removes certain triangles of the mesh while decreasing
    error to give less triangles on the surface


    WindowSync Smooth:
            Smooths more than Laplacian smooth
            still smooths caps of arteries

    Densify:
            divides triangles based on “Num Divisions”
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/editing/globalSmoothing.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>    
   

<p><strong>Smoothing a PolyData Model (Local):</strong></p>

<p>There are specialized operations to perform function only on specific portions of the model.</p>

<p>Navigate to &ldquo;Model → PolyData → Local Ops&rdquo;. There are four ways to select regions of the model for localized operations. </p>
<pre class="highlight plaintext"><code>1. Face Selection - Highlight faces in the list, and then click "Add Faces" to add the faces to the  "Local Parameters" window will be operated on. Only these faces will be operated on now when performing local operations.
2. Blend - When faces are highlighted and then added to the "Local Parameters" window, a special region will be selected for operation. The boundary between the two faces will be found and the radius value corresponds to the size of a sphere to be selected from this boundary region to perform localized operations. 
2. Sphere Region - With a model highlighted, select "Show Sphere Interactor". Move the sphere around and set a radius for the sphere. When the desired location is selected, click "Add Sphere Region". This will add a line to the "Local Parameters" window. 
2. Cell Selection - First, a model must be displayed as a Full Model. Then, it is possible to select a cell with "c", or multiple with "C". After selecting cells, click "Add Cells" to add these cells to the "Local Parameters" window. 
</code></pre>

<p>Highlight the walls of the surface and click &ldquo;Add Faces&rdquo; under the &ldquo;Face Selection&rdquo; Tab. </p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/editing/selectingLocalRegions.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>    

<p>This will add the following line to the Local Parameters window:</p>
<pre class="highlight plaintext"><code>faces 1 2 ModelFaceID ActiveCells 1
</code></pre>

<p>These have the following meaning:</p>
<pre class="highlight plaintext"><code>* faces - Use faces as local region selection
* 1 2 - These are the ids of the faces the use for region selection
* ModelFaceID (Do not change!) - This is the array to look for on the polydata for the face ids
* ActiveCells (Do not change!) - This is the arrayname to give for region selection
* 1 (Do not change!) - This designates that the output region selection array will be a cell data array
</code></pre>

<p>Now, when an operation is clicked (i.e Decimate, Laplacian Smooth), the information in the Local Parameters window is used to set the local regions. If you no longer want to use a region selection, the line should be deleted from this window!
Local Surface Operators summary:</p>
<pre class="highlight plaintext"><code>    Decimate Surface:
            Based on target rate, removes certain triangles of the mesh while decreasing
    error to give less triangles on the surface

    Laplacian Smooth:
            smooths the bumps and ridges of the model
            Laplacian Smooth -&gt; Relax Factor -&gt; Choose between .01 and .05 

Constrain Smooth:
    Uses an alteration of laplacian smoothing. New surface becomes a 
    minimization between the original surface and the laplacian smoothed
    surface
    Num Iters - Choose between 3 and 10
    Constrain Factor - How much the smoothed surface should be 
    pushed back to the original - Choose between 0 and 1.

   Linear Suvdivision
            Divides the meshing triangles based on number placed in “Num Divisions”
            For example, to divide each triangle into four triangles: Num Divisions = 1
            This creates a finer mesh made up of smaller triangles
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/editing/localSmoothing.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>    

<p><strong>Trimming a PolyData Model:</strong></p>

<p>To trim a model, that is to cut a piece of it off that you don’t want:
        Navigate to Model -&gt; PolyData -&gt; Trim</p>

<p>Cut Surface:</p>
<pre class="highlight plaintext"><code>Highlight the model you would like to trim in the box window.

    Cut with plane -&gt; check on “Show Plane Interactor”
    move the interactor to the desired position and click “Cut Above” or “Cut Below” 
            This will cut either above or below the entire plane depending on its orientation shown by the arrows 

    Cut with box -&gt; check on “Show Box Interactor”
            expand the box in any direction by clicking and dragging the grey spheres that appear
            rotate the box by clicking on a face of the box and dragging
            “Cut With Box” -&gt; cuts all of the model contained inside the box

    Save model: File Input/Output -&gt; click “Save Model”
            name “demo_trimmed.vtp”, make sure it is in the right directory, click save
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/editing/polydataTrim.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>    

<p><br>
<br>
<br></p>
</section>
<section id="modelingCenterlinesPolyData" class="subgroup"><h3>Extracting Centerlines of a PolyData</h3>

<p>Sometimes it is desirable to get the centerlines of your model. In order to do this, navigate to the &ldquo;Model → PolyData → Centerline Extraction&rdquo;</p>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/centerlines/addingFaces.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>
<pre class="highlight plaintext"><code>    Highlight the desired model in the list and then click "Extract Centerlines"
A window should pop up asking you to select the walls of your model. Highlight ALL of the walls of your model and then hit "Enter" on your keyboard
Wait for a while as it can take some time to generate the centerlines
When done, the centerlines will be visualized on the screen
</code></pre>

<figure>
  <img class="svImg svImgXl"  src="documentation/modeling/imgs/polyData/centerlines/visualizedCenterlines.png"> 
  <figcaption class="svCaption" ></figcaption>
</figure>

<p>Toggle the viewing of the centerlines and the voronoi diagram of the model. These can also be saved as polydatas and click the Save buttons to do this.</p>

<p>In the end, it is also possible to convert these centerlines to SimVascular pathlines to alternatively use as guide lines for 2D segmentation. Click &ldquo;Convert Centerlines to Pathlines&rdquo; in order to do this. </p>

<p><br>
<br>
<br></p>
</section>
</div>






    </div>
</div>    


    <!-- /.container -->
    <nav class="navbar navbar-default navbar-fixed-bottom">
        <div class="container-fluid text-center">
          <ul class="nav navbar-nav">
            <li><a>Copyright &copy; SimVascular Development Team - 2017</a></li>                
          </ul>
        </div>
        <!-- /.container -->
    </nav>

    
    <script src="js/jquery-1.11.0.js" type="text/javascript"></script><script src="js/bootstrap.min.js" type="text/javascript"></script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
      $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 40
      });
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-55333921-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</body>

</html>
